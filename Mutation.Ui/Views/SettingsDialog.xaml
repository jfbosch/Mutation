<ContentDialog
    x:Class="Mutation.Ui.Views.SettingsDialog"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:Mutation.Ui.Views"
    xmlns:vm="using:Mutation.Ui.ViewModels"
    Title="Application Settings"
    DefaultButton="Primary"
    PrimaryButtonText="Save"
    SecondaryButtonText="Cancel"
    CloseButtonText="Reset"
    PrimaryButtonClick="ContentDialog_PrimaryButtonClick"
    SecondaryButtonClick="ContentDialog_SecondaryButtonClick"
    CloseButtonClick="ContentDialog_CloseButtonClick"
    Width="900"
    MaxWidth="1000"
    Height="640"
    MaxHeight="800">

    <ContentDialog.Resources>
        <local:ValidationStateToVisibilityConverter x:Key="InvalidStateToVisibilityConverter" />

        <DataTemplate x:Key="InfoTemplate" x:DataType="vm:SettingRowViewModel">
            <Grid ColumnSpacing="16" RowSpacing="4">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="220" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <FontIcon
                    FontFamily="Segoe Fluent Icons"
                    Glyph="&#xE783;"
                    Foreground="{ThemeResource SystemFillColorCriticalBrush}"
                    Visibility="Collapsed" />
                <StackPanel Grid.Column="1" Spacing="2">
                    <TextBlock Text="{x:Bind DisplayName}" Style="{StaticResource CaptionTextStyle}" />
                    <TextBlock Text="{x:Bind Description}" TextWrapping="Wrap" />
                </StackPanel>
                <TextBlock Grid.Column="2" Text="{x:Bind Value}" TextWrapping="Wrap" />
            </Grid>
        </DataTemplate>

        <DataTemplate x:Key="NumberTemplate" x:DataType="vm:SettingRowViewModel">
            <Grid ColumnSpacing="16" RowSpacing="4">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="220" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <FontIcon
                    FontFamily="Segoe Fluent Icons"
                    Glyph="&#xE783;"
                    Foreground="{ThemeResource SystemFillColorCriticalBrush}"
                    Visibility="{x:Bind ValidationState, Converter={StaticResource InvalidStateToVisibilityConverter}}" />
                <StackPanel Grid.Column="1" Spacing="2">
                    <TextBlock Text="{x:Bind DisplayName}" Style="{StaticResource CaptionTextStyle}" />
                    <TextBlock Text="{x:Bind Description}" TextWrapping="Wrap" />
                </StackPanel>
                <NumberBox
                    Grid.Column="2"
                    Minimum="1"
                    Maximum="20"
                    SpinButtonPlacementMode="Compact"
                    Value="{x:Bind Value, Mode=TwoWay}"
                    HorizontalAlignment="Left"
                    Width="140" />
                <TextBlock Grid.Column="2" Margin="0,32,0,0" Text="{x:Bind ValidationMessage}" Foreground="{ThemeResource SystemFillColorCriticalBrush}" />
            </Grid>
        </DataTemplate>

        <DataTemplate x:Key="ActionTemplate" x:DataType="vm:SettingRowViewModel">
            <Grid ColumnSpacing="16" RowSpacing="4">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="220" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <FontIcon FontFamily="Segoe Fluent Icons" Glyph="&#xE783;" Opacity="0" />
                <StackPanel Grid.Column="1" Spacing="2">
                    <TextBlock Text="{x:Bind DisplayName}" Style="{StaticResource CaptionTextStyle}" />
                    <TextBlock Text="{x:Bind Description}" TextWrapping="Wrap" />
                </StackPanel>
                <Button Grid.Column="3" Content="{x:Bind ActionLabel}" Click="ActionButton_Click" Tag="{x:Bind}" />
            </Grid>
        </DataTemplate>

        <local:SettingTemplateSelector x:Key="SettingTemplateSelector"
                                       InfoTemplate="{StaticResource InfoTemplate}"
                                       NumberTemplate="{StaticResource NumberTemplate}"
                                       ActionTemplate="{StaticResource ActionTemplate}" />
    </ContentDialog.Resources>

    <Grid RowSpacing="12">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <TextBlock Text="Fine-tune how Mutation behaves." Style="{StaticResource SubtitleTextStyle}" />

        <Grid Grid.Row="1" ColumnSpacing="24">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="220" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <ListView
                Grid.Column="0"
                ItemsSource="{x:Bind ViewModel.Categories}"
                SelectedItem="{x:Bind ViewModel.SelectedCategory, Mode=TwoWay}"
                SelectionMode="Single"
                IsItemClickEnabled="True">
                <ListView.ItemTemplate>
                    <DataTemplate x:DataType="vm:CategoryViewModel">
                        <StackPanel Padding="12,8" Orientation="Vertical">
                            <TextBlock Text="{x:Bind Name}" />
                        </StackPanel>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>

            <ItemsControl
                Grid.Column="1"
                ItemsSource="{x:Bind ViewModel.SelectedCategory?.Rows}">
                <ItemsControl.ItemTemplateSelector>
                    <StaticResource ResourceKey="SettingTemplateSelector" />
                </ItemsControl.ItemTemplateSelector>
                <ItemsControl.ItemContainerStyle>
                    <Style TargetType="ContentPresenter">
                        <Setter Property="Margin" Value="0,8,0,8" />
                    </Style>
                </ItemsControl.ItemContainerStyle>
            </ItemsControl>
        </Grid>
    </Grid>
</ContentDialog>
